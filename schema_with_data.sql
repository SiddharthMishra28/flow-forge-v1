-- H2 2.2.224;
;             
CREATE USER IF NOT EXISTS "SA" SALT 'e580c04fbbf55d75' HASH 'a40b6fb1c8eefe764bb6bf7dd3fde886a6930b02df57c8eadfb7fc05bf161449' ADMIN;         
CREATE MEMORY TABLE "PUBLIC"."APPLICATIONS"(
    "ID" BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1 RESTART WITH 3) NOT NULL,
    "APPLICATION_NAME" CHARACTER VARYING(255) NOT NULL,
    "CREATED_AT" TIMESTAMP(6) NOT NULL,
    "GITLAB_PROJECT_ID" CHARACTER VARYING(255) NOT NULL,
    "PERSONAL_ACCESS_TOKEN" CHARACTER VARYING(255) NOT NULL,
    "UPDATED_AT" TIMESTAMP(6) NOT NULL
);   
ALTER TABLE "PUBLIC"."APPLICATIONS" ADD CONSTRAINT "PUBLIC"."CONSTRAINT_C" PRIMARY KEY("ID"); 
-- 2 +/- SELECT COUNT(*) FROM PUBLIC.APPLICATIONS;            
INSERT INTO "PUBLIC"."APPLICATIONS" VALUES
(1, 'app1', TIMESTAMP '2025-09-09 19:21:13.709918', '68536844', 'glpat-ZkSGCEP09blAmXk9Qoj1sW86MQp1OjduMjRpCw.01.120ftcixd', TIMESTAMP '2025-09-09 19:21:13.709918'),
(2, 'app2', TIMESTAMP '2025-09-09 19:21:37.536892', '68536939', 'glpat-ZkSGCEP09blAmXk9Qoj1sW86MQp1OjduMjRpCw.01.120ftcixd', TIMESTAMP '2025-09-09 19:21:37.536892');      
CREATE MEMORY TABLE "PUBLIC"."FLOW_EXECUTIONS"(
    "ID" UUID NOT NULL,
    "CREATED_AT" TIMESTAMP(6) NOT NULL,
    "END_TIME" TIMESTAMP(6),
    "FLOW_ID" BIGINT NOT NULL,
    "RUNTIME_VARIABLES" JSON,
    "START_TIME" TIMESTAMP(6),
    "STATUS" CHARACTER VARYING(255)
);       
ALTER TABLE "PUBLIC"."FLOW_EXECUTIONS" ADD CONSTRAINT "PUBLIC"."CONSTRAINT_55" PRIMARY KEY("ID");             
-- 1 +/- SELECT COUNT(*) FROM PUBLIC.FLOW_EXECUTIONS;         
INSERT INTO "PUBLIC"."FLOW_EXECUTIONS" VALUES
(UUID '62b3725f-9d16-4679-8357-f7c6c02d89a7', TIMESTAMP '2025-09-09 19:27:51.334844', TIMESTAMP '2025-09-09 19:30:04.637139', 1, JSON '{"VERSION":"1.0.0","API_KEY":"123456","var3":"var3 data","var2":"some other data","var1":"some data","ENVIRONMENT":"production"}', TIMESTAMP '2025-09-09 19:27:51.293825', 'PASSED');   
CREATE MEMORY TABLE "PUBLIC"."FLOW_STEPS"(
    "ID" BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1 RESTART WITH 3) NOT NULL,
    "APPLICATION_ID" BIGINT NOT NULL,
    "BRANCH" CHARACTER VARYING(255) NOT NULL,
    "CREATED_AT" TIMESTAMP(6) NOT NULL,
    "SQUASH_STEP_IDS" JSON,
    "TEST_DATA_IDS" JSON,
    "TEST_STAGE" CHARACTER VARYING(255) NOT NULL,
    "TEST_TAG" CHARACTER VARYING(255) NOT NULL,
    "UPDATED_AT" TIMESTAMP(6) NOT NULL
);    
ALTER TABLE "PUBLIC"."FLOW_STEPS" ADD CONSTRAINT "PUBLIC"."CONSTRAINT_7" PRIMARY KEY("ID");   
-- 2 +/- SELECT COUNT(*) FROM PUBLIC.FLOW_STEPS;              
INSERT INTO "PUBLIC"."FLOW_STEPS" VALUES
(1, 1, 'main', TIMESTAMP '2025-09-09 19:25:39.311349', JSON '[1,2,3,4]', JSON '[1]', 'setup', 'sanity', TIMESTAMP '2025-09-09 19:25:39.311349'),
(2, 2, 'main', TIMESTAMP '2025-09-09 19:26:05.214509', JSON '[5,6,7]', JSON '[1,2]', 'setup', 'regression', TIMESTAMP '2025-09-09 19:26:05.214509');              
CREATE MEMORY TABLE "PUBLIC"."FLOWS"(
    "ID" BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1 RESTART WITH 2) NOT NULL,
    "CREATED_AT" TIMESTAMP(6) NOT NULL,
    "FLOW_STEP_IDS" JSON NOT NULL,
    "SQUASH_TEST_CASE_ID" BIGINT NOT NULL,
    "UPDATED_AT" TIMESTAMP(6) NOT NULL
);           
ALTER TABLE "PUBLIC"."FLOWS" ADD CONSTRAINT "PUBLIC"."CONSTRAINT_3" PRIMARY KEY("ID");        
-- 1 +/- SELECT COUNT(*) FROM PUBLIC.FLOWS;   
INSERT INTO "PUBLIC"."FLOWS" VALUES
(1, TIMESTAMP '2025-09-09 19:26:42.196129', JSON '[1,2]', 14156, TIMESTAMP '2025-09-09 19:26:42.196129');
CREATE MEMORY TABLE "PUBLIC"."PIPELINE_EXECUTIONS"(
    "ID" BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1 RESTART WITH 3) NOT NULL,
    "CREATED_AT" TIMESTAMP(6) NOT NULL,
    "END_TIME" TIMESTAMP(6),
    "FLOW_EXECUTION_ID" UUID NOT NULL,
    "FLOW_ID" BIGINT NOT NULL,
    "FLOW_STEP_ID" BIGINT NOT NULL,
    "INITIAL_TEST_DATA" JSON,
    "PIPELINE_ID" BIGINT,
    "PIPELINE_URL" CHARACTER VARYING(255),
    "RUNTIME_TEST_DATA" JSON,
    "START_TIME" TIMESTAMP(6),
    "STATUS" CHARACTER VARYING(255)
);
ALTER TABLE "PUBLIC"."PIPELINE_EXECUTIONS" ADD CONSTRAINT "PUBLIC"."CONSTRAINT_A6" PRIMARY KEY("ID");         
-- 2 +/- SELECT COUNT(*) FROM PUBLIC.PIPELINE_EXECUTIONS;     
INSERT INTO "PUBLIC"."PIPELINE_EXECUTIONS" VALUES
(1, TIMESTAMP '2025-09-09 19:27:51.392601', TIMESTAMP '2025-09-09 19:28:56.164356', UUID '62b3725f-9d16-4679-8357-f7c6c02d89a7', 1, 1, JSON '{"var2":"some other data","var1":"some data"}', 2029960316, 'https://gitlab.com/org_rzx/flow_forge_proj1/-/pipelines/2029960316', JSON '{"API_KEY":"123456","ENVIRONMENT":"production","VERSION":"1.0.0"}', TIMESTAMP '2025-09-09 19:27:51.383606', 'PASSED'),
(2, TIMESTAMP '2025-09-09 19:28:57.879687', TIMESTAMP '2025-09-09 19:30:01.077863', UUID '62b3725f-9d16-4679-8357-f7c6c02d89a7', 1, 2, JSON '{"var2":"some other data","var1":"some data","var3":"var3 data"}', 2029962816, 'https://gitlab.com/org_rzx/flow_forge_proj2/-/pipelines/2029962816', JSON '{"VERSION":"1.0.0","var3":"var3 data","API_KEY":"123456","var2":"some other data","var1":"some data","ENVIRONMENT":"production"}', TIMESTAMP '2025-09-09 19:28:57.879688', 'PASSED'); 
CREATE MEMORY TABLE "PUBLIC"."TEST_DATA"(
    "DATA_ID" BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1 RESTART WITH 3) NOT NULL,
    "CREATED_AT" TIMESTAMP(6) NOT NULL,
    "TEST_DATA" JSON NOT NULL,
    "UPDATED_AT" TIMESTAMP(6) NOT NULL
);  
ALTER TABLE "PUBLIC"."TEST_DATA" ADD CONSTRAINT "PUBLIC"."CONSTRAINT_6" PRIMARY KEY("DATA_ID");               
-- 2 +/- SELECT COUNT(*) FROM PUBLIC.TEST_DATA;               
INSERT INTO "PUBLIC"."TEST_DATA" VALUES
(1, TIMESTAMP '2025-09-09 19:23:38.734264', JSON '{"var2":"some other data","var1":"some data"}', TIMESTAMP '2025-09-09 19:23:38.734264'),
(2, TIMESTAMP '2025-09-09 19:24:00.227868', JSON '{"var3":"var3 data"}', TIMESTAMP '2025-09-09 19:24:00.227868');        
ALTER TABLE "PUBLIC"."PIPELINE_EXECUTIONS" ADD CONSTRAINT "PUBLIC"."CONSTRAINT_A" CHECK("STATUS" IN('RUNNING', 'PASSED', 'FAILED', 'CANCELLED')) NOCHECK;     
ALTER TABLE "PUBLIC"."FLOW_EXECUTIONS" ADD CONSTRAINT "PUBLIC"."CONSTRAINT_5" CHECK("STATUS" IN('RUNNING', 'PASSED', 'FAILED', 'CANCELLED')) NOCHECK;         
